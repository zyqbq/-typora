# 初识 Cookie

1.Cookie 是什么

   Cookie 全称 HTTP Cookie，简称 Cookie

   是**浏览器存储数据**的一种方式

   因为存储在用户**本地**，而不是存储在服务器上，是本地存储

   一般会自动随着浏览器每次请求发送到服务器端



   2.Cookie 有什么用

   利用 Cookie 跟踪统计用户访问该网站的习惯，比如什么时间访问，访问了哪些页面，在每个网页的停留时间等，方便了解用户习惯



   3.在浏览器中操作 Cookie

   不要在 Cookie 中保存密码等敏感信息

Application

# Cookie 的基本用法

 1.写入 Cookie

```js
document.cookie = 'username=zs';
 document.cookie = 'age=18';
```



   不能一起设置，只能一个一个设置

   document.cookie = 'username=zs; age=18';x



   2.读取 Cookie

```js
   console.log(document.cookie);
```



   读取的是一个由名值对构成的字符串，每个名值对之间由“; ”（一个分号和一个空格）隔开

   username=zs; age=18

# Cookie 的属性

### 1.Cookie 的名称（Name）和值（Value）

   最重要的两个属性，创建 Cookie 时必须填写，其它属性可以使用默认值



   Cookie 的名称或值如果包含非英文字母，则写入时需要使用 **encodeURIComponent() 编码**，读取时使用 decodeURIComponent() 解码

   document.cookie = 'username=alex';



   ```js
   document.cookie = `username=${encodeURIComponent('张三')}`;
   document.cookie = `${encodeURIComponent('用户名')}=${encodeURIComponent( '张三' )}`;
   ```

   一般**名称**使用英文字母，不要用中文，值可以用中文，但是要编码



### 2.失效（到期）时间

   对于失效的 Cookie，会被浏览器清除

   如果没有设置失效（到期）时间，这样的 Cookie 称为**会话 Cookie**

   它存在内存中，当会话结束，也就是**浏览器关闭时，Cookie 消失**

   这样是默认状态



   ```js
   document.cookie = 'username=alex';
   ```



   想长时间存在，设置 Expires 或 Max-Age

####    **expires**

   值为 Date 类型

   ```js
   document.cookie = `username=alex; expires=${new Date('2100-1-01 00:00:00')}`;
   ```





####    **max-age**

   值为数字，表示当前时间 + 多少秒后过期，单位是秒

  

   ```js
    document.cookie = 'username=alex; max-age=5'; //5秒后过期
   document.cookie = `username=alex; max-age=${24 * 3600 * 30}`;//30天过期
   ```



   如果 max-age 的值是 0 或负数，则 Cookie 会被删除

   ```js
   document.cookie = 'username=alex';
   
   document.cookie = 'username=alex; max-age=0';
   
   document.cookie = 'username=alex; max-age=-1';
   ```



###    3.Domain 域

   Domain 限定了访问 Cookie 的范围（不同域名）



   使用 JS 只能读写当前域或父域的 Cookie，无法读写其他域的 Cookie

   ```js
   document.cookie = 'username=alex; domain=www.imooc.com';
   document.cookie = 'username=alex; domain=.imooc.com';
   ```

   www.imooc.com m.imooc.com 当前域

   父域：.imooc.com



###    4.Path 路径

默认是/表示根目录

   Path 限定了访问 Cookie 的范围（同一个域名下）



   使用 JS 只能读写**当前路径和上级路径的 Cookie，无法读写下级路径的 Cookie**

  ```js
   document.cookie = 'username=alex; path=/course/list';
     document.cookie = 'username=alex; path=/1.Cookie/';
  ```



   **当 Name、Domain、Path 这 3 个字段都相同的时候，才是同一个 Cookie**



###    5.HttpOnly

   设置了 HttpOnly 属性的 Cookie 不能通过 JS 去访问



###    6.Secure 安全标志

   Secure 限定了只有在使用了 **https** 而不是 http 的情况下才可以发送给服务端



   **Domain、Path、Secure 都要满足条件，还不能过期的 Cookie 才能随着请求发送到服务器端**

# Cookie 的封装

html

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Cookie 的封装</title>
</head>

<body>
  <button id="cn">中文</button>
  <button id="en">英文</button>

  <script type="module">
    // 使用封装好的 Cookie 实现网站语言切换
    import { set } from './cookie.js';
    const cnBtn = document.getElementById('cn');
    const enBtn = document.getElementById('en');

    cnBtn.addEventListener(
      'click',
      () => {
        set('language', 'cn', {
          maxAge: 30 * 24 * 3600
        });
        window.location = './2-6.Cookie 的封装.html';//跳转到当前页面，也就是刷新
      },
      false
    );
    enBtn.addEventListener(
      'click',
      () => {
        set('language', 'en', {
          maxAge: 30 * 24 * 3600
        });
        window.location = './2-6.Cookie 的封装.html';
      },
      false
    );
  </script>
</body>

</html>
```

cookie.js

```js
// 写入 Cookie
const set = (name, value, { maxAge, domain, path, secure } = {}) => {
  let cookieText = `${encodeURIComponent(name)}=${encodeURIComponent(value)}`;

  if (typeof maxAge === 'number') {
    cookieText += `; max-age=${maxAge}`;
  }

  if (domain) {
    cookieText += `; domain=${domain}`;
  }

  if (path) {
    cookieText += `; path=${path}`;
  }

  if (secure) {
    cookieText += `; secure`;
  }

  document.cookie = cookieText;

  // document.cookie='username=alex; max-age=5; domain='
};

// 通过 name 获取 cookie 的值
const get = name => {
  name = `${encodeURIComponent(name)}`;

  const cookies = document.cookie.split('; ');

  for (const item of cookies) {
    const [cookieName, cookieValue] = item.split('=');

    if (cookieName === name) {
      return decodeURIComponent(cookieValue);
    }
  }

  return;
};

// 'username=alex; age=18; sex=male'
// ["username=alex", "age=18", "sex=male"]
// ["username","alex"]

// get('用户名');

// 根据 name、domain 和 path 删除 Cookie
const remove = (name, { domain, path } = {}) => {
  set(name, '', { domain, path, maxAge: -1 });
};

export { set, get, remove };

```

# Cookie 的注意事项

### 1.前后端都可以创建 Cookie



### 2.Cookie 有数量限制

   每个域名下的 Cookie **数量有限**



   当超过单个域名限制之后，再设置 Cookie，浏览器就会清除以前设置的 Cookie



### 3.Cookie **有大小限制**

   每个 Cookie 的存储容量很小，最多只有 4KB 左右

# 初识 localStorage

1.localStorage 是什么

   localStorage 也是一种浏览器存储数据的方式（本地存储），它只是存储在本地，不会发送到服务器端



   单个域名下的 localStorage 总大小有限制



 2.在浏览器中操作 localStorage



 3.localStorage 的基本用法

   console.log(localStorage);

### setItem()

设置localStorage数据

```js
localStorage.setItem('username', 'alex');
      localStorage.setItem('username', 'zs');
      localStorage.setItem('age', 18);
      localStorage.setItem('sex', 'male');
```

有几条数据length

```js
  console.log(localStorage.length);
```

获取localstorage数据

```js
   getItem()
      console.log(localStorage.getItem('username'));
      console.log(localStorage.getItem('age'));

      // 获取不存在的返回 null
      console.log(localStorage.getItem('name'));
```

删除

```js
 removeItem()
      localStorage.removeItem('username');
      localStorage.removeItem('age');

      // 删除不存在的 key，不报错
      localStorage.removeItem('name');
```

全部清除

```js
// clear()
      localStorage.clear();

      console.log(localStorage);
```

4.使用 localStorage 实现自动填充

```js
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>初识 localStorage</title>
  </head>
  <body>
    <form id="login" action="https://www.imooc.com" method="post">
      <input type="text" name="username" />
      <input type="password" name="password" />
      <input type="submit" id="btn" value="登录" />
    </form>

    <script>
      // 4.使用 localStorage 实现自动填充
      const loginForm = document.getElementById('login');
      const btn = document.getElementById('btn');

      const username = localStorage.getItem('username');
      if (username) {
        loginForm.username.value = username;
      }

      btn.addEventListener(
        'click',
        e => {
          e.preventDefault();//阻止默认的点击提交事件
          // 数据验证

          // console.log(loginForm.username.value);

          localStorage.setItem('username', loginForm.username.value);

          loginForm.submit();
        },
        false//冒泡写法
      );
    </script>
  </body>
</html>

```

# sessionStorage

sessionStorage用于临时保存同-窗口(或标签页)的数据，在关闭窗口或标签页之后将会删除这些数据。

1,setitrm()保存数据

2,getitem（）读取数据

3,remove（）删除指定键数据

4,clear（）删除所有数据

5,cookie、localStorage、sessionStorage的区别   

（1）cookie会在服务器和浏览器之间传递，localStorage和sessionStorage不会发给服务器，仅在本地保存   

（2）cookie存储数据小，不超过4k。localStorage和sessionStorage存储大小也有限制，但是比cookie大，一般5M左右   

（3）cookie可以通过自带属性设置有效期，当不设置有效期，浏览器关闭，cookie就会消失；当设置有效期后，在有效期内，关闭浏览器或者窗口，它依然存在。到有效期后，cookie会自动消失。localStorage没有自带属性的设置有效期，长期本地化存在的，除非手动删除。sessionStorage在关闭浏览器或者窗口时会被删除。    

（4）cookie和localStorage在同源窗口是共享的，sessionStorage在不同的窗口不能共享。
